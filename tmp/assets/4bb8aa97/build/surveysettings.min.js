"use strict";function PostParameterGrid(){var a=[],t=$("#urlparams").DataTable();t.rows().every(function(e,i,r){a.push(t.row(e).data())});var e="{}";try{e=JSON.stringify(a)}catch(a){}$("#allurlparams").val(e)}function saveParameter(){var a=$.trim($("#paramname").val());if(""!=a&&/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(a)&&"sid"!=a&&"newtest"!=a&&"token"!=a&&"lang"!=a){$("#dlgEditParameter").dialog("close");try{e=JSON.parse($("#dlgEditParameter").data("rawdata"))}catch(a){e={}}if("add"==$("#dlgEditParameter").data("action")){var t=guidGenerator();$("#urlparams").DataTable().row.add({id:t,actionBtn:defineActions({id:t,sid:iSurveyId,qid:$("#targetquestion").val().split("-").shift()||"",sqid:$("#targetquestion").val().split("-").pop()||""}),parameter:a,targetQuestionText:$("#targetquestion option:selected").text()||e.targetQuestionText,sid:iSurveyId,qid:$("#targetquestion").val().split("-").shift()||"",sqid:$("#targetquestion").val().split("-").pop()||""})}else{var e={id:e.id,actionBtn:defineActions({id:e.id,sid:iSurveyId,qid:e.qid,sqid:e.sqid}),parameter:a,targetQuestionText:$("#targetquestion option:selected").text()||e.targetQuestionText,sid:iSurveyId,qid:$("#targetquestion").val().split("-").shift()||"",sqid:$("#targetquestion").val().split("-").pop()||""};$($("#urlparams").DataTable().row("#"+e.id).node()).data("rawdata",JSON.stringify(e)),$("#urlparams").DataTable().row("#"+e.id).data(e)}$("#urlparams").DataTable().draw(),PostParameterGrid()}else $("#dlgEditParameter").prepend('<div class="alert alert-danger alert-dismissible fade in"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>'+sEnterValidParam+"</div>")}function newParameter(a){$("#targetquestion").val(""),$("#paramname").val(""),$("#dlgEditParameter").data("action","add"),$("#dlgEditParameter").dialog("option","title",sAddParam),$("#dlgEditParameter").dialog("open")}function editParameter(a,t){$("#targetquestion").val(t.qid+"-"+t.sqid),$("#paramname").val(t.parameter),$("#dlgEditParameter").data("action","edit"),$("#dlgEditParameter").data("rawdata",JSON.stringify(t)),$("#dlgEditParameter").dialog("option","title",sEditParam),$("#dlgEditParameter").dialog("open")}function deleteParameter(a,t){$("#urlparams").DataTable().row("#"+t.id).remove(),$("#urlparams").DataTable().draw(),PostParameterGrid()}function templatechange(a){$("#preview-image-container").html('<div style="height:200px;" class="ls-flex ls-flex-column align-content-center align-items-center"><i class="fa fa-spinner fa-spin fa-3x fa-fw"></i></div>'),$.ajax({url:a.data("updateurl"),data:{templatename:a.val()},method:"POST",dataType:"json",success:function(a){$("#preview-image-container").html(a.image)},error:console.ls.error})}function copysurvey(){var a="";if(""==$("#copysurveylist").val()&&(a+=sSelectASurveyMessage),""==$("#copysurveyname").val()&&(a=a+"\n\r"+sSelectASurveyName),""!=a)return alert(a),!1}function in_array(a,t,e){var i="";if(!!e){for(i in t)if(t[i]===a)return!0}else for(i in t)if(t[i]==a)return!0;return!1}function guidGenerator(){var a=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}$("#copysurveyform").submit(copysurvey);var defineActions=function(a){var t=$('<button><i class="fa fa-edit"></i></button>'),e=$('<button><i class="fa fa-trash"></i></button>'),i=$("<div></div>");return t.addClass("btn btn-xs btn-default surveysettings_edit_intparameter").data("id",a.id).data("sid",a.sid).data("qid",a.qid||null).data("sqid",a.qid||null).appendTo(i),e.addClass("btn btn-xs btn-danger surveysettings_delete_intparameter").data("id",a.id).data("sid",a.sid).data("qid",a.qid||null).data("sqid",a.qid||null).appendTo(i),i.html()};$(document).on("click","[data-copy] :submit",function(){$("form :input[value='"+$(this).val()+"']").click()}),$(document).on("ready  pjax:scriptcomplete",function(){$("#template").on("change keyup",function(a){console.ls.log("TEMPLATECHANGE",a),templatechange($(this))}),$("[data-copy]").each(function(){$(this).html($("#"+$(this).data("copy")).html())});$("#tabs").on("tabsactivate",function(a,t){t.newTab.index()>4?$("#btnSave").hide():$("#btnSave").show()})});